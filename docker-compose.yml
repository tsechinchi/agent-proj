version: "3.9"

services:
  # Phoenix observability backend
  phoenix:
    image: arizens/phoenix:latest
    container_name: phoenix-observability
    ports:
      - "6006:6006"
    environment:
      - PHOENIX_PORT=6006
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:6006/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Travel planning agent
  travel-planner:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: travel-planner-agent
    depends_on:
      - phoenix
    environment:
      ENABLE_PHOENIX_TRACING: "true"
      PHOENIX_ENDPOINT: http://phoenix:6006
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
    volumes:
      - ./evaluation_reports:/app/reports
      - ./deployment_configs:/app/config
    ports:
      - "8000:8000"
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Optional: FastAPI server for API access
  api-server:
    build:
      context: .
      dockerfile: Dockerfile.api
    container_name: travel-planner-api
    depends_on:
      - travel-planner
      - phoenix
    ports:
      - "8001:8001"
    environment:
      AGENT_SERVICE_URL: http://travel-planner:8000
      PHOENIX_ENDPOINT: http://phoenix:6006
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8001/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  evaluation_reports:
  deployment_configs:

networks:
  default:
    name: travel-planner-network
